(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(n,e,t){n.exports=t(55)},55:function(n,e,t){"use strict";t.r(e);var a=t(1),r=t.n(a),c=t(20),i=t.n(c),o=t(4),s=t(5),u=t(7),l=t(3),h=t(8),d=t(0),f=t.n(d),p=t(2),v=t(21),w=t.n(v),k=function(){return window.location.href.replace(window.location.hash,"").replace(window.location.search,"")},b=function(){return w.a.parse(window.location.search.replace("?",""))},C=function(n){return btoa(n.sdp)},y=function(n,e){return{type:e,sdp:atob(n)}},m=function(n,e,t){n[e]=Object(p.a)(f.a.mark(function a(){return f.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t();case 3:a.next=8;break;case 5:a.prev=5,a.t0=a.catch(0),n[e]&&n[e]();case 8:case"end":return a.stop()}},a,null,[[0,5]])})),n[e]()},j=function(){function n(e){Object(o.a)(this,n),this.config=e}return Object(s.a)(n,[{key:"createConnectionWithOffer",value:function(){var n=Object(p.a)(f.a.mark(function n(){var e,t,a;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,e=this._createConnection(),t=e.createDataChannel("data"),n.next=5,e.createOffer();case 5:return a=n.sent,n.next=8,e.setLocalDescription(a);case 8:return n.abrupt("return",{connection:e,dataChannel:t});case 11:throw n.prev=11,n.t0=n.catch(0),new Error("Error initializing channel: Cannot create offer");case 14:case"end":return n.stop()}},n,this,[[0,11]])}));return function(){return n.apply(this,arguments)}}()},{key:"createConnectionWithAnswer",value:function(){var n=Object(p.a)(f.a.mark(function n(e){var t,a;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t=this._createConnection(),n.next=4,t.setRemoteDescription(e);case 4:return n.next=6,t.createAnswer();case 6:return a=n.sent,n.next=9,t.setLocalDescription(a);case 9:return n.abrupt("return",t);case 12:throw n.prev=12,n.t0=n.catch(0),new Error("Error initializing channel: Cannot create answer");case 15:case"end":return n.stop()}},n,this,[[0,12]])}));return function(e){return n.apply(this,arguments)}}()},{key:"getOffer",value:function(){var n=Object(p.a)(f.a.mark(function n(e){var t;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.store.get(e.token);case 3:return t=n.sent,n.abrupt("return",y(t,"offer"));case 7:throw n.prev=7,n.t0=n.catch(0),new Error("Error joining channel: Cannot read offer data");case 10:case"end":return n.stop()}},n,this,[[0,7]])}));return function(e){return n.apply(this,arguments)}}()},{key:"getAnswer",value:function(){var n=Object(p.a)(f.a.mark(function n(e){var t;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.store.get(this._getAnswerToken(e));case 3:return t=n.sent,n.abrupt("return",y(t,"answer"));case 7:throw n.prev=7,n.t0=n.catch(0),new Error("Error joining channel: Cannot read answer data");case 10:case"end":return n.stop()}},n,this,[[0,7]])}));return function(e){return n.apply(this,arguments)}}()},{key:"saveOffer",value:function(){var n=Object(p.a)(f.a.mark(function n(e,t){var a;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this._getSessionDescription(e);case 3:return a=n.sent,n.next=6,this.store.save(t.token,a);case 6:n.next=11;break;case 8:throw n.prev=8,n.t0=n.catch(0),new Error("Error initializing channel: Cannot write offer data");case 11:case"end":return n.stop()}},n,this,[[0,8]])}));return function(e,t){return n.apply(this,arguments)}}()},{key:"saveAnswer",value:function(){var n=Object(p.a)(f.a.mark(function n(e,t){var a;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this._getSessionDescription(e);case 3:return a=n.sent,n.next=6,this.store.save(this._getAnswerToken(t),a);case 6:n.next=11;break;case 8:throw n.prev=8,n.t0=n.catch(0),new Error("Error initializing channel: Cannot write answer data");case 11:case"end":return n.stop()}},n,this,[[0,8]])}));return function(e,t){return n.apply(this,arguments)}}()},{key:"setConnectHandler",value:function(n,e,t){e.onopen=function(){return t.connect(n,e)}}},{key:"setDisconnectHandler",value:function(n,e){n.oniceconnectionstatechange=function(t){var a=n.iceConnectionState,r="failed"===a||"disconnected"===a||"closed"===a;e.isConnected&&r&&e.disconnect()}}},{key:"setWaitHandler",value:function(n,e){var t=this;m(e,"$waitAnswer",Object(p.a)(f.a.mark(function a(){var r;return f.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.getAnswer(e);case 2:return r=a.sent,a.next=5,n.setRemoteDescription(r);case 5:case"end":return a.stop()}},a)})))}},{key:"_createConnection",value:function(){return new RTCPeerConnection({iceServers:this.config.iceServers})}},{key:"_getSessionDescription",value:function(n){return new Promise(function(e){n.onicecandidate=function(t){null===t.candidate&&e(C(n.localDescription))}})}},{key:"_getAnswerToken",value:function(n){return n.token+"-answer"}},{key:"store",get:function(){return this.config.store}}]),n}(),O=t(11),g=t(10),x=t.n(g),E=t(22),_=t.n(E),D=function(n){function e(){var n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_()();return Object(o.a)(this,e),(n=Object(u.a)(this,Object(l.a)(e).call(this))).token=t,n.connection=null,n.dataChannel=null,n}return Object(h.a)(e,n),Object(s.a)(e,[{key:"send",value:function(n){this._checkConnected(),this.dataChannel.send(n)}},{key:"disconnect",value:function(){var n=this.isConnected;this.dataChannel&&this.dataChannel.close(),this.connection&&this.connection.close(),this.connection=null,this.dataChannel=null,this.$waitAnswer=null,n&&this.emit("disconnected")}},{key:"connect",value:function(n,e){var t=this;this._checkNotConnected(),this.connection=n,this.dataChannel=e,this.dataChannel.onmessage=function(n){var e=n.data;e&&t.emit("data",e)},this.emit("connected")}},{key:"on",value:function(n,t){return"connected"===n&&this.isConnected&&t(),Object(O.a)(Object(l.a)(e.prototype),"on",this).call(this,n,t)}},{key:"_checkConnected",value:function(){if(!this.isConnected)throw new Error("Error: Not connected")}},{key:"_checkNotConnected",value:function(){if(this.isConnected)throw new Error("Error: Already connected")}},{key:"isConnected",get:function(){return null!==this.dataChannel}}]),e}(x.a),S=t(9),A=function(n){function e(n,t){var a;return Object(o.a)(this,e),(a=Object(u.a)(this,Object(l.a)(e).call(this)))._handleConnection=a._handleConnection.bind(Object(S.a)(Object(S.a)(a))),a._handleDisconnection=a._handleDisconnection.bind(Object(S.a)(Object(S.a)(a))),a._handleData=a._handleData.bind(Object(S.a)(Object(S.a)(a))),a.channel1=n,a.channel2=null,a.selectedChannel=null,a._subscribeChannel(a.channel1,function(){return a.channel2}),t&&a.connect(t),a}return Object(h.a)(e,n),Object(s.a)(e,[{key:"send",value:function(n){this._checkConnected(),this.selectedChannel.send(n)}},{key:"disconnect",value:function(){this.channel1.disconnect(),this.channel2&&this.channel2.disconnect(),this._clean()}},{key:"connect",value:function(n){var e=this;this.channel2=n,this._subscribeChannel(this.channel2,function(){return e.channel1})}},{key:"on",value:function(n,t){return"connected"===n&&this.isConnected&&t(),Object(O.a)(Object(l.a)(e.prototype),"on",this).call(this,n,t)}},{key:"_checkConnected",value:function(){if(!this.isConnected)throw new Error("Error: Not connected")}},{key:"_subscribeChannel",value:function(n,e){var t=this;n.on("connected",function(){t._handleConnection(n)}).on("disconnected",function(){t._handleDisconnection(n,e())}).on("data",this._handleData)}},{key:"_handleConnection",value:function(n){this.isConnected||(this.selectedChannel=n,this.emit("connected"))}},{key:"_handleDisconnection",value:function(n,e){var t=this.isConnected;e&&e.isConnected?this.selectedChannel=e:t&&(this._clean(),this.emit("disconnected"))}},{key:"_handleData",value:function(n){this.emit("data",n)}},{key:"_clean",value:function(){this.selectedChannel=null,this.$waitChannel2=null}},{key:"token",get:function(){return this.channel1.token}},{key:"isConnected",get:function(){return null!==this.selectedChannel}}]),e}(x.a),W=t(13),T=t.n(W),R={store:{save:function(n,e){var t="http://scooterlabs.com/echo.json?data="+encodeURIComponent(e),a=encodeURIComponent(t),r=this._getCallUrl("/create.php?url=".concat(a,"&alias=").concat(n,"&submit=Make%20TinyURL!"));return T.a.get(r).then(this._adaptResponse)},get:function(n){return T.a.get(this._getCallUrl("/".concat(n))).then(this._adaptResponse).then(function(n){return JSON.parse(n).request.data}).then(function(n){return decodeURIComponent(n)})},_adaptResponse:function(n){var e=n.data;if(!e.status||200!==e.status.http_code)throw new Error("Request failed");return e.contents},_getCallUrl:function(n){return"https://api.allorigins.win/get?url="+encodeURIComponent("https://tinyurl.com"+n)}},iceServers:[{urls:"stun:stun.l.google.com:19302"}]},U=new j(R),I={createChannel:function(){var n=Object(p.a)(f.a.mark(function n(){var e,t,a=this;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.createSingleChannel();case 2:return e=n.sent,t=new A(e),m(t,"$waitChannel2",Object(p.a)(f.a.mark(function n(){var e;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.joinSingleChannel(t.token+"-2");case 2:e=n.sent,t.connect(e);case 4:case"end":return n.stop()}},n)}))),n.abrupt("return",t);case 6:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),joinChannel:function(){var n=Object(p.a)(f.a.mark(function n(e){var t,a;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.joinSingleChannel(e);case 2:return t=n.sent,n.next=5,this.createSingleChannel(e+"-2");case 5:return a=n.sent,n.abrupt("return",new A(t,a));case 7:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}(),createSingleChannel:function(){var n=Object(p.a)(f.a.mark(function n(e){var t,a,r,c;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=new D(e),n.next=3,U.createConnectionWithOffer();case 3:return a=n.sent,r=a.connection,c=a.dataChannel,n.next=8,U.saveOffer(r,t);case 8:return U.setConnectHandler(r,c,t),U.setDisconnectHandler(r,t),U.setWaitHandler(r,t),n.abrupt("return",t);case 12:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),joinSingleChannel:function(){var n=Object(p.a)(f.a.mark(function n(e){var t,a,r;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=new D(e),n.next=3,U.getOffer(t);case 3:return a=n.sent,n.next=6,U.createConnectionWithAnswer(a);case 6:return r=n.sent,n.next=9,U.saveAnswer(r,t);case 9:return r.ondatachannel=function(n){var e=n.channel;U.setConnectHandler(r,e,t)},U.setDisconnectHandler(r,t),n.abrupt("return",t);case 12:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),setStore:function(n){R.store=n},setIceServers:function(n){R.iceServers=n}},N=function(n){function e(){var n,t;Object(o.a)(this,e);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(t=Object(u.a)(this,(n=Object(l.a)(e)).call.apply(n,[this].concat(r)))).state={token:null},t}return Object(h.a)(e,n),Object(s.a)(e,[{key:"render",value:function(){return this.state.token?r.a.createElement("div",null,"Send this link to your peer and wait...",r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("a",{href:this.link},this.link)):r.a.createElement("div",null,"Wait...")}},{key:"componentDidMount",value:function(){var n=Object(p.a)(f.a.mark(function n(){return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return window.channel&&window.channel.disconnect(),n.next=3,I.createChannel();case 3:window.channel=this.channel=n.sent,this.setState({token:this.channel.token}),this.channel.on("connected",function(){window.location.hash="#/chat"});case 6:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}()},{key:"link",get:function(){var n=k();return"".concat(n,"?token=").concat(this.state.token,"#/join")}}]),e}(a.Component),H=function(n){function e(){return Object(o.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(h.a)(e,n),Object(s.a)(e,[{key:"render",value:function(){return this.inviteToken?r.a.createElement("div",null,"Wait..."):r.a.createElement("div",null,"Invalid token.")}},{key:"componentDidMount",value:function(){var n=Object(p.a)(f.a.mark(function n(){var e=this;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.inviteToken){n.next=2;break}return n.abrupt("return");case 2:return window.channel&&window.channel.disconnect(),n.next=5,I.joinChannel(this.inviteToken);case 5:window.channel=this.channel=n.sent,this.channel.on("connected",function(){window.channel=e.channel,window.location.hash="#/chat"});case 7:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}()},{key:"inviteToken",get:function(){return b().token||null}}]),e}(a.Component),M=t(23),L=function(n){function e(){var n,t;Object(o.a)(this,e);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(t=Object(u.a)(this,(n=Object(l.a)(e)).call.apply(n,[this].concat(r)))).state={messages:[],input:""},t}return Object(h.a)(e,n),Object(s.a)(e,[{key:"render",value:function(){var n=this;return window.channel?r.a.createElement("div",null,r.a.createElement("textarea",{value:this.state.messages.join("\n"),readOnly:!0,rows:15,ref:function(e){return n.textarea=e},style:{width:"100%"}}),r.a.createElement("br",null),r.a.createElement("input",{type:"text",value:this.state.input,onChange:function(e){n.setState({input:e.target.value})},onKeyDown:function(e){"Enter"===e.key&&(window.channel.send(n.state.input),n.setState({input:""}),n._addMessage("Me: ".concat(n.state.input)))},ref:function(e){return n.input=e},style:{width:"100%"}})):r.a.createElement("div",null,"No connection.")}},{key:"componentDidMount",value:function(){var n=this,e=window.channel;e&&(e.on("data",function(e){n._addMessage("Stranger: ".concat(e))}),e.on("disconnected",function(){alert("DISCONNECTED!"),window.location.hash="#/"}),this.input.focus())}},{key:"componentWillUnmount",value:function(){window.channel&&(window.channel.disconnect(),window.channel=void 0)}},{key:"_addMessage",value:function(n){var e=this;this.setState({messages:[].concat(Object(M.a)(this.state.messages),[n])},function(){e.textarea.scrollTop=e.textarea.scrollHeight})}}]),e}(a.Component),z=function(n){function e(){return Object(o.a)(this,e),Object(u.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(h.a)(e,n),Object(s.a)(e,[{key:"render",value:function(){var n=window.location.hash;return n.startsWith("#/create")?r.a.createElement(N,null):n.startsWith("#/join")?r.a.createElement(H,null):n.startsWith("#/chat")?r.a.createElement(L,null):r.a.createElement("div",null,r.a.createElement("h1",null,"Valid urls:"),"/#/create",r.a.createElement("br",null),"/#/join?token=INVITE_TOKEN",r.a.createElement("br",null),r.a.createElement("br",null),">"," ",r.a.createElement("a",{href:"https://github.com/rodri042/quickp2p",target:"_blank",rel:"noopener noreferrer"},"Source code and instructions"))}},{key:"componentWillMount",value:function(){var n=this;this._listener=window.addEventListener("hashchange",function(e){n.forceUpdate()})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this._listener)}}]),e}(a.Component);i.a.render(r.a.createElement(z,null),document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.65d35c2d.chunk.js.map